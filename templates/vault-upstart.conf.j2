description "Vault server"
start on runlevel [2345]
stop on runlevel [!2345]

setuid {{ hashi_vault_user_info['user'] }}
setgid {{ hashi_vault_user_info['group'] }}

respawn
script
  # Make sure to use all our CPUs, because Vault can block a scheduler thread
  export GOMAXPROCS=`nproc`
  exec {{ hashi_vault_install_dir }}/vault server -config={{ hashi_vault_config }} >>/var/log/vault.log 2>&1
end script
